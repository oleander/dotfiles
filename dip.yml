# yaml-language-server: $schema=https://raw.githubusercontent.com/bibendi/dip/refs/heads/master/schema.json

version: "8"

provision:
  - echo "Provisioning..."

interaction:
  install-linux:
    description: Install the dotfiles in Linux environment
    service: homeassistant
    command: ./install
    compose:
      run_options: [--rm, --remove-orphans]

  install-macos:
    description: Install the dotfiles in macOS environment
    service: macos
    command: ./install
    compose:
      run_options: [--rm, --remove-orphans]

  install-codespaces:
    description: Install the dotfiles in GitHub Codespaces environment
    service: codespaces
    command: ./install -c install-github.conf.yaml
    compose:
      run_options: [--rm, --remove-orphans]

  verify-codespaces:
    description: Verify the dotfiles installation in GitHub Codespaces environment
    service: codespaces
    command: ./test/verify-codespaces.sh
    compose:
      run_options: [--rm, --remove-orphans]

  test-codespaces-bins:
    description: Test all inst/github binaries in Codespaces environment
    service: codespaces
    command: "for script in inst/github/*; do echo \"Testing $script...\"; chmod +x \"$script\"; ~/.local/bin/inst-$(basename \"$script\") || true; echo \"----------------\"; done"
    compose:
      run_options: [--rm, --remove-orphans]

  codespaces-shell:
    description: Start a shell in the Codespaces container
    service: codespaces
    command: /bin/bash
    compose:
      run_options: [--rm, --remove-orphans, -it]

  test-linux:
    description: Run the dotfiles test suite
    service: homeassistant
    command: ./test/test_ssh_keys.sh
    compose:
      run_options: [--rm, --remove-orphans]

  test-macos:
    description: Run the dotfiles test suite
    service: macos
    command: ./test/test_ssh_keys.sh
    compose:
      run_options: [--rm, --remove-orphans]

  test-script:
    description: Test a single installation script on Linux
    service: homeassistant
    compose:
      run_options: [--rm, --remove-orphans]
