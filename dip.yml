# yaml-language-server: $schema=https://raw.githubusercontent.com/bibendi/dip/refs/heads/master/schema.json

version: '7.1'

environment:
  COMPOSE_EXT: yml

provision:
  - dip compose down -v
  - dip compose up -d

interaction:
  test:
    description: Run the dotfiles test suite
    service: homeassistant
    command: ./test/test_ssh_keys.sh
    compose:
      run_options: [--rm, --remove-orphans]

  install-linux:
    description: Install the dotfiles in Linux environment
    service: homeassistant
    command: ./install
    compose:
      run_options: [--rm, --remove-orphans]

  install-macos:
    description: Install the dotfiles in macOS environment
    service: macos
    command: ./install
    compose:
      run_options: [--rm, --remove-orphans]

  clean:
    description: Clean up test containers and volumes
    command: dip compose down -v

  shell-linux:
    description: Open a shell in the Linux environment
    service: homeassistant
    command: /bin/bash
    compose:
      run_options: [--rm, --remove-orphans]

  shell-macos:
    description: Open a shell in the macOS environment
    service: macos
    command: /bin/bash
    compose:
      run_options: [--rm, --remove-orphans]
