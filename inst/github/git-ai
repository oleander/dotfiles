#!/bin/bash

set -x
set -e

# Check if we're in a Codespaces environment
if [ -n "$CODESPACES" ]; then
    echo "Running in GitHub Codespaces environment"

    # Check if cargo is already installed
    if ! command -v cargo &> /dev/null; then
        echo "Cargo not found, installing..."
        curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
        source "$HOME/.cargo/env"
    else
        echo "Cargo is already installed"
    fi
else
    # Non-Codespaces environment
    sudo apt-get update
    sudo apt-get install -y --no-install-recommends curl cargo
fi

# Install cargo-binstall if not already installed
if ! command -v cargo-binstall &> /dev/null; then
    curl -L --proto '=https' --tlsv1.2 -sSf https://raw.githubusercontent.com/cargo-bins/cargo-binstall/main/install-from-binstall-release.sh | bash
fi

# Install git-ai
cargo binstall -y git-ai
