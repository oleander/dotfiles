#!/usr/bin/env ruby

unless system "[[ -z $(git status -s) ]]"
  abort "Please commit your changes first"
end

zsh_config = "~/.dotfiles/zshrc"

unless system "zsh -c 'source #{zsh_config}'"
  abort "Check #{zsh_config}, it fails"
end

puts "Update oh my zsh locally"
system "upgrade_oh_my_zsh"

puts "Push to Github"
system "git push"

["ocean", "atlantic"].each do |host|
  puts "Updating #{host} host"
  system "ssh #{host} 'cd ~/.dotfiles && git stash && git pull && source #{zsh_config} && upgrade_oh_my_zsh'"
end